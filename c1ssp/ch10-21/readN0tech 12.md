ch.12   安全通信與網路攻擊
```
身份認證協議
-PPP point to point protocol 鏈路wan傳輸IP流量 數據層 ip管理、同步通信管理
>'標準化'封裝、多路複用、連路配置、質量測試、功能協商、自動連接、全雙工、身份認證
>取代串行線路網間協議SLIP 不提供身份認證、沒有偵錯、需手動建立移除鏈路

PAP|密碼身份驗證協議|passwd authentication protocol
>'明文傳輸'帳號密碼簡單傳輸途徑、把登入證書從客戶端傳遞到身份認證服務器
CHAP|徵詢握手身份驗證協議|challenge handshake md5 不安全 被MS-CHAPv2更新算法 取代
>以建立會話期間會週期重覆驗證遠程系統、確保用戶身份持續有效、不透過網路發送密碼

*EAP|可擴產身份認證協議|extensible   支持可指定身份認證解決方案 MFA 安全通道、加密
LEAP|lightweight| 輕量級cisco WPA TKIP的替代方案，802.11i/WPA被批准之前，解決TKIP缺陷、不使用
PEAP|protected| 受保護的，在TLS隧道封裝EAP安全性、支持交叉驗證
*EAP-SIM|subscriber idenntity| sim卡識別 GSM移動設備永，該卡用戶的帳戶服務級別相關
EAP-FAST|flexible authentication via secure tunneling| cisco取代LEAP、由於WAP2發展
EAP-MD5|MD5| 最早EAP的方法，但已棄用
*EAP-POTP|protected OTP| MFA 令牌 、用於單向或交叉身份認證．
*EAP-TLS|TLS|開放的IETF,保護身份驗證的流量TLS協議、雙方都具有數字證書的交叉身份認證
*EAP-TTLS|tunneled TLS|EAP-TLS的擴展、進行端點驗證前創建類似VPN隧道，確保不用明文方式傳輸．

IEEE802.1X 基於端口訪問控制，定義封裝EAP的使用，支持LAN連接廣泛身分認證，認證前無法通信
>企業無線客戶端專用遠程身分認證系統或AAA(RADIUS,TACACS+)充當身分認證代理
>是一種認證技術不是無線技術，用於WAP、FW、SW、Router、proxy、VPN gateway、NAS, RAS(遠程訪問服務器)
>容易被中間人MITM和劫持攻擊，鎖已建立連接不是所有的802.1X,EAP是安全，需要期間再認證和會話加密
***
端口安全  未使用不需要的插孔或port應斷開線路、監控何時連接或斷開或被無效設備替換、需被身分認證(NAC)
服務質量QoS   通信效率和性能監督和管理，可調整、限制、重塑網絡流量，備用傳輸路徑、移除沒關鍵數據傳輸。。 可用性
^^^SDN 設施和控制分離、嗅探捕獲網路數據進行分析^^^

語音通信安全   PSTN公共交換電話網、專用交換機PBX、移動蜂窩服務、VoIP
-PSTN公共交換電話網 易受攔截、竊聽、破解攻擊 應使用加密通信
**
-VoIP 網路電話支持再TCP/IP 提供安全實時傳輸協議(SRTP)的加密
>使用相同的ISP可能不提供任何形式加密，只兼容設備到供應商之間的加密、否則就到了網關要解密在加密
>強密碼、MFA、log、是否異常活動、阻止國際電話、外包給信任的SaaS、更新設備固件、
>限制相關網路設備的物理訪問、教育訓練、阻止不存在或無效號碼、防止幽靈呼號、部屬帶有NIPS功能的VoIP

VoIP社交工程vishing
-看起來奇怪來歷不名來電小心，涉及敏感、個人、財務、機密要一值確認身分、對信息進行分級、清楚標誌可語音的討論
-若索要特權信息應詢問請求原因、檢驗身分、回報給安全人員、禁止單一通信交出或更改密碼、拒釣魚關聯號碼、利用來電ID標示黑名單

專用交換機PBX private branch exchange 欺騙和濫用  150(分機)電話共用20條租任線
-用信任卡或呼叫卡替代進行遠程長距離呼叫、業務類型的合法提供撥入撥出功能、使用未公布或與線在使用不同號碼、保護PBX管理員接口
-停止任何未分配訪問號或帳戶、紀錄稽核所有活動、禁止任何形式的遠程管理訪問、**更改默認配置尤其密碼**及有關特權的功能、阻止遠程呼叫
-定期使用供應商更新系統、採用DISA直接撥入系統季數減少外部實體PBX的欺騙
-邏輯、技術控制、管理控制及物理控制來保護

飛客攻擊phreaking     繞過電話系統計費功能、免費撥打改變盜用服務功能導致崩潰

遠程訪問安全管理
-透過VPN接入、連接到WAP、接入終端服務器系統、虛擬私有雲VPC端點、虛擬桌面、虛擬移動接口、
--->使用調製解調器波入遠程訪問服務器，直接連到LAN
遠程訪問遠程辦公技術
-特定服務 為用戶遠程接入使用單一服務功能(mail)、遠程控制 遙控操作
-遠程節點操作: 與LAN建立直接連接的另一個名稱 提供網絡服務及可能的互聯網連接、抓屏錄屏 截桌面顯示的畫面

遠程連接安全
-嚴格身分認證才可獲得訪問權限、工作需要特定人員可建立遠端連線、
--->建立**前需加密技術保護身份和傳輸數據來保護和監控、
-遠端連接人員使用不安全或低安全系統訪問敏感數據會造成巨大丟失和洩漏破壞、可能成為惡意代碼傳入的載體、
-難以進行故障定位的遠程連接問題、連接速率慢會造成難以升級補丁
***
遠程訪問安全策略
-連接技術全面檢查、傳輸保護的加密協議選擇服務VPN/TLS，
--->身份認證保護的中心化身份認證系統或多因子驗證、用戶助手解決軟硬體和培訓
-NAC可幫助訪問安全風險降低，但大量傳輸更新與補丁而加重降低速率

遠程會議 支持下和不用戶之間通信、交換數據、協作完成材料數據文檔或其他合作服務、可視為遠程會議技術服務
-使否使用牆身份認證、開放協議或、密通道端點到服務器還是端到端、允許真正刪除會議內容、活動審查和日誌紀錄
-未授權是否參加私人會議、共享插入、進用廣告跟垃圾郵件、有用什麼跟蹤機制
--->禁用跟蹤、用什麼收集數據、會議被記錄下來、誰可以接觸、能被導出和分發

即時通訊和聊天 IM instant messaging 端對端、端對集中控制服務器
-漏洞：嗅探、本地缺乏安全認證加密、社工、假冒、誘騙、PII、知識產權保密信息．
```
常見負載均衡調度技術
|技術|描述||
|:--|:--|:--|
|隨機選擇|每個數據或連接|隨機分配目的地|
|循環|每個數據或連接|分配下一個目的地1234512345|
|負載監測|當前負載或容量為每個數據包或連接|丟到當前負載最低接收|
|優先或加權|根據已知或偏好|分組或連接分配目的地|
|最少連接流量延遲|根據活動連結最少數量流量延遲|每個數據包或連接分配目的地|
|基於地理位置|根據目的地與LB相對距離|每個數據包或連接分配目的地|
|基於關聯位置|依據前次連結分配目的地(CDN)|將後續分配到相同目的地|
```
虛擬IP   已負載均衡調度的形制被分配給另一組IP地址運行實際系統
負載持久性 客戶與群成員之間建立會話，後續通信還是送同一組(持久、一致)
主動--主動  所有可用路徑或系統，故障時分攤
主動--被動  某些路徑和系統未使用休眠狀態，當主動失效馬上接手


管理電子郵件安全目標
-只收件人可訪問、消息完整性、身分和來源驗證、不可否認、驗證傳遞消息、敏感內容分級
-策略: 可接受郵件使用、訪問控制和隱私、備份和保留年限
-不安全明文協議 : SMTP、POP、IMAP、因現本地支持HTML代碼也包括JS、訪問就自動執行這些代碼
S/MIME 安全/多用途互聯網郵件擴展  secure multipurpose internet mail extensious
-通過公鑰加密、數字信封、數據簽名提供身份認證(ca X509證書)和保密性保護、完整性、發件人身份認證、不可否認性
-通過符合公鑰加密表準(PKCS)加密技術提供隱私保護
-PGP良好隱私   點對點對稱密鑰系統使用大量加密演算法加密文件和郵件消息，不是個標準但事實上的標準狀態
>OpenPGP 遵循GunPGP提高郵件隱私和完整保護

-DKIM   域名關鍵字標示郵件  通過驗證域名標示來自組織的有效、用來防止郵件內容遭到竄改
-->對這封郵件做簽章解碼，如果公鑰與私鑰能配對成功，代表郵件確實為原始發信機所發出。

-SPF 發件人策略框架 透過SMTP域名配置防止垃圾郵件和郵件欺騙、檢查發送的主機是否獲得SMTP域名擁有者授權來確定有效性
-DMARC 域消息身份認證報告和一致性 基於DNS電子郵件身份認證系統(無效就丟棄) 防止商業電子郵件洩漏BEC、釣魚信或其他欺詐行為、
-->用來輔助SPF與DKIM的不足用來讓發信端網域通知收件端郵件服務器。

-STARTTLS 透過TLS使用安全SMTP、嘗試用TLS方式建立初始連接後使用STARTTLS命令
>如果支持TLS協商加密通道，否則將保持明文、使用TCP587、可與IMAP連接一起使用、但POP3則用STLS命令執行類似功能
-隱式SMTPS SMTP TLS加密形式 支持用協商加密，若不支持連接將會結束TCP465

VPN 虛擬專用網   兩個實體跨越不可信網路建立通道  訪問控制、身份認證、機密性、完整性、加密保護封裝流量、但加密不是必要元素
>VPN集中器 支持大量同步VPN連接 提供高可用性、高擴展性、高性能、單個主機不須在本地支持VPN功能

隧道技術tunneling  數據包封撞到另一協議報文、對數據內容進行保密 (旁路防火牆、網關、代理)
-防止流量控制裝置阻擋或丟棄數據、因為裝置也不知道真實內容、一種低效通信方式、報文體量數量變多易造成擁塞
-流量內容監控困難、因為是加密所以不可查看訪問掃描過濾、所以要被解密正常後LAN流量後進行操作
****
VPN工作處理
-遠程節點操作  通過網路直連LAN的其他用戶執行相同活動資源
-IPsec   主機到主機、端對端連接傳輸保持加密
## transport end to end、不对IP包头加密，AH头或ESP头在原来的IP头后面
-傳輸模式   不對通信報頭進行加密、僅在單系統之間的可信網路使用
## tunnel gw to gw、对整个IP数据包都加密了
-隧道模式   需跨越不信任網路或連結和來自多系統時
-鏈路加密VPN 點對點建立VPN連接後、與本地LAN連接相同、只有一部分才提供加密、可能存在不受VPN保護網段

-始終在線VPN  建立在與非本地網絡連結、wifi連接分有線連接使用、每次使用在線資源建立安全連接
-分割隧道 split tunnel 允許VPN連結的可信的客戶端通過VPN和互聯網訪問組織LAN網路、沒良好過濾服務亦發起入侵或洩露機密數據

-全隧道 full tunnel 客戶端所有流量通過VPN連路發送到組織網路得代理或防火牆接口、所有流量都由組織安全基礎設施過路和管理

>L2 | PPTP|點對點隧道協議tcp1723   通過PPP相同身份認證協議 PAP CHAP EAP MS-CHAPv2
>>PTPP初始隧道協商過程不是加密、但現採用MS-CHAPv2使用微軟的點對點加密MPPE進行數據加密並支持多種身份認證、已過時還是被支援

>L2 | L2TP|UDP1701 第二層隧道協議  結合PPTP轉發VPN協議特點成為互聯網標準RFC2661
>>L2TP不提供本地加密但支持負載加密協議使用、
--->L2TP其实是PPTP和L2F的组合，缺乏内置的加密方案，所以经常和 IPSec结合，L2TP支持TACACS+和RADIUS
>>IEEE 802.1x使L2TP能夠利用或借用任何可用的AAA服務器的身份認證服務

-GRE通用路由封裝是cisco專用隧道協議用於建立VPN、GRE封裝但不加密
>TLS |SSH(22 p)| 是telnet(明文) rlogin.rsh.rexec,rcp的安全替代品
>>用於加密協議(SFTP,SEXEC,Slogin,Scp)類似TLS操作也被稱為VPN協議、只限於傳輸加密模式(OpenSSH)
>>>S前綴是由加密SSH提供、但後綴S是由加密TLS提供

>OpenVPN| 基於(TLS)提供簡易配置安全可靠的VPN選項、可使用共享密碼證書進行身份驗證
>>許多支持家用或商業WAP用做VPN網關
```
```
-IPsec| IPv4作為附加組建、用途在內外部或網路建立VPN鏈路指在IP網路工作提供身份認證和加密數據傳輸
>>L2TP-->L2TP/IPSec,是一組協議包含 AH,ESP,HNAC,IPComp,IKE
***
>AH|authentication header身份認證頭 消息完整性和不可否認、會話訪問控制、防止重放攻擊
^^^ipsec主要身份驗證機制
>ESP|encapsulatingSecurityPayload 封裝安全載荷 有效負載內容的保密性和完整性、支援連傳輸模式和隧道模式
^^^ipsec加密程序
>>提供加密、有限身份認證、防治重放攻擊、通常使用AES加密、允許不使用AH建立自己的連結、定期重新身份認證、檢測響應灰化劫持

>HMAC|hash-based 基於哈希消息身份認證碼  哈希校驗
--->Hash2.0，文件先加密碼再取MAC, HMAC:使用雜湊計算MAC||CBC-MAC:使用Cipher計算MAC

>IPComp|IP payloadCompression 加密前的壓縮工具、提升速率
>IKE|互聯網密鑰交換 三元素,
^^^ipsec管理加密密鑰機制
>> OAKLEY(生成ECDHE密鑰交換協議類似DH), SKEME安全交換機制機制
>> ISAKMP互聯網安全關聯和密鑰管理協議(管理OAKLEY和生成SKEME交換密鑰) 
>>使用IPsec的EAP進行有效負載加密、兩個獨立加密單工信道組成
```

```
vlan by sw、路由器連結不同子網創建IP和掩碼、FW：控制管理流量

交換機四個功能、學習、轉發、丟棄、泛洪
-根據內容尋址內存(CAM)表檢查源MAC地址、CAM保存在交換機內存(MAC地址+端口號)
>如果源MAC地址不在就添加進去、出口跟接收端口不同則將幀從出口發送出去、若端口相同則丟棄幀、
>若MAC地址不在CAM表從所有端口發送出去、即使目的地未知仍允許幀到達其目的地

VLAN虛擬局域網 網路分段技術、管理員逐端口更改分配、用戶流量與管理流量、依據設備MAC地址、IP子網劃分、特定協議或身份認證
-控制流量和阻止進出流量、不同VLAN之間不提供路由功能、特定VLAN之間設置拒絕過濾規則、”拒絕常態允許列外“
-VLAN邏輯分段不必更改物理網路拓樸、
--->雲分布式虛擬機有助於減少引入配置錯誤和集中管理並可以使用基礎設施及代碼體IaC系結構管理
-VLAN有助於控制和限制廣播流量(乙太網廣播垃圾流量)、減少流量嗅探
-端口鏡像是受管理交換機上的功能、SPAN（交換端口分析器）複製特定端口的流量、做流量分析、數據包捕獲、證據收集、入侵檢測
-端口監聽 port tap  當SPAN不滿足偵聽需求、將竊聽器插入原始端口

MAC flooding 泛洪攻擊 濫用交換機的學習功能陷入泛洪狀態、帶有隨機新的源mac地址乙太網幀添加到CAM表、
-表滿之後舊的會被刪除、出現錯誤無法發送正確發通信量就會返回到泛洪模式、
-攻擊者不會進入客戶與服務器之間通信路徑、而會得到通信副本、攻擊者通過受損交換機進行任何通信
-防禦：MAC限制從每個插口端口進入CAM表的MAC地址數、NIDS識別正在嘗試MAC泛洪攻擊

MAC克隆 手動NIC配置檢查若發生衝突需更換NIC(網路介面控制器)硬件或將MAC修改的備用地址、常見於繞過端口安全或MAC過濾限制(SW,WAP)
-對策：智能交換機或NIDS監控奇怪MAC使用和濫用、維護設備和MAC清單已受權、未知或惡意的
```
```
NAT常常与代理服务器或代理防火墙结合。

NAT=PAT 網路地址轉換 隱藏內部用戶身份和屏蔽私有網路RFC1918架構、防止外部學習網路內部的配置
-利用NAT共享公共IPv4接入互聯網、內部使用RFC1918協議的IPv4仍可進行通信、通過NAT向外部隱藏內部IPv4劃分
-NAT對連接的限制只有內部受保護連接留才被允許通過阻擋入侵攻擊會被自動攔截、NAT基本的單向防火牆只允許響應內部系統請求傳入流量
-NAT動態將數據抱頭中內部系統的私有IPv4地址轉換為外部、允许多个内部客户端使用较少外部IP，动态分配。
-NAT相關的是端口地址轉換(PAT、超載NAT)、
-->網路與端口地址轉換(NPAT)、網路地址與端口轉換(NAPT)允許單公共IPv4來自65,536(限4,000)的內部客戶端同時通信

-NAT-T(RFC3947)NAT遍歷 因IPsec要求NAT數據包頭更改、傳統不支援IPsecVPN、
--->但支援專用L2TP的隧道模式可跨同邊界設備接口的NAT和VPN獲益

-靜態NAT(反向代理、端口轉發或DNAT目標網絡地址轉換)可被配置為執行入站映射、不與IPv6一起使用
>允許外部實體使用映射為重定向到內部系統專用地址的專用公共套接自來起動與NAT後面內部提體通信、但不建議
>靜態NAT可能對屏蔽子網或外網系統有用、但絕對不適合用於訪問內部專用LAN系統
--->指特定的内部IP地址永久映射到特定的外部IP地址。

不能反覆使用NAT  NAT後又NAT
-用一台路由器將該子網連接到現有網路的某一個端口、只能單條連接但有多台需要上網、會對所使用的IPv4地址產生配置產生影響
-不能對同一子網再次使用NAT、而需要通過NAT新路由器或WAP的地址專換不同段地址就不會產生衝突．
-路由器和流量定向設備被默認不轉發來自或發往這些IPv4地址的數據包、所以私有IPv4不能直接用於網路
-勿再互聯網直接使用RFC1918定義的私有IPv4、因所有公用可達路由器都會丟包含RFC1918定義的IPv4地址數據包

-SNAT=狀態NAT 原網路地址轉址 映射和IPv4地址套接自分配在會話啟動創建、中斷就解散
狀態NAT  內部用戶請求報文的源地址改為NAT服務器地址跟目的地址一起紀錄NAT數據庫、收到回覆訊息信在映射數據庫比對所屬用戶地址
-維護用戶與外部系統之間通信會話信息
＊＊
自動私有IP分配 APIPA automatic private ip adderssing(RFC3927 windows) 當動態主機配置DHCP分配失敗情況繼續為系統分配IP
-但無法跨越路由或其他配置正確的IP(不是有效網路地址)、可能是DHCP當機或受惡意攻擊

環回地址loopback address用於本地網路測試、不受硬件或相關狀態影響、廣泛使用只在127.0.0.1
第三方連接  組織要有明確理由允許遠程工作、可能被良性行為用於合法目的、或被對手用於惡意目的
```
```
＊＊
電路交換 兩個通信實體之間建立專用物理通道、斷開再次通話則建立不同路徑
分組交換   每個數據都有自己的頭、選適合路由數據段發送給接收者、傳輸通道和通信路徑只給需要傳送的分組
-需恰當連接管理、流量隔離和加密技術共享物理路徑安全、常因物理路徑損壞而中斷

虛電路(通信路徑)邏輯路祭或電路在分組交換網路兩個特定端點建立、純再多條路徑
-PVC永久虛電路 permanent virtual circuit 租用鏈路
>邏輯電路保持時刻等待用戶發送數據、需要時隨時開啟
-SVC交換式虛電路switched virtual circuit
>可用最佳路徑建立、結束後就拆除

WAN(廣域網) 需正確連接管理及傳輸加密、專用線路(dedicated line租用 特定點對點保持等待狀態)
--->常用於多點業務辦公、但基於光纖方案所取代
--->提高租用路線或載波網路的容錯能力、需部署兩條冗余連接
-ISDN(integreated Services Digital Network綜合業務數字網)取代PSTN但為廣泛使用並大多已停用
衛星通信  依然提供高速數據傳輸、但須強大的加密措施讓沒付費無法解密出內容

光纖鏈路 硬件及物理層標準定義基礎設施和線速需求、使用同步時分復用TDM技術、高速全雙工通信、經常作為骨幹網並將其容量切分供用戶使用
-SDH(STM模塊)同步數字系列 國際電信聯盟ITU標準
-SONET(STS信令)同步光纖網路 美國ANSI標準
STS=1/OC-1|STM-0|51.84m
STS=3/OC-3|STM-1|155.52m
STS=12/OC-12|STM-4|622.08m
STS=48/OC-48|STM-16|2.488g
STS=96/OC-96|STM-32|4.976g
...
STS=768/OC-768|STM-256|39.813

透明性是安全控制一項必要特徵  越透明用戶越不可能繞過或察覺不到他的存在
傳輸日誌 通信的審計技術 源地址、目的地址、時戳、識別碼、傳輸狀態、報文數量、消息大小，可對非法追蹤、工作數據提取
傳輸錯誤糾正  發現整體或不受破壞更改或丟失、再請求重新傳送

竊聽 eavesdropping 複製獲取通信內容、竊聽裝置難以茶瘸因為是被動攻擊、當改對通信內容更改或注入就是主動攻擊
-方式：複製到儲存裝置、提取流量數據動態提取原始內容
-抵禦：加密技術、一次性身份驗證、應用允許列表防止未授權軟體

竄改攻擊 modification attacks 補獲報文修改後再發送給系統(數字簽名驗證、報文效驗)
```
