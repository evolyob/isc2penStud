ch.17 事件預防響應

```
以限制或遏制事件發展受影響降至最低
事件定義 CIA產生負面影響的任何事情
>安全事件：攻擊導致、用戶惡意蓄意導致、
>RFC2350：危害計算機或網路安全某方面任何不利事件
>NIST SP 800-61：違背或即將違背計算機安全策略、可接受策略或標準安全實踐規範的情況
-任何未遂網路入侵拒絕服務攻擊、對惡意軟件任何檢測、未經授權訪問、違背安全策略的行為

事件管理步驟
--->>自動化工具檢測、響應、事件遏止在範圍內、證據保護、根據法歸通報、復原完全運行、根因分析防止再次發生建議、經驗教訓
>>>SP 800-61 事件響應生命週期：準備、檢測分析、遏制根除和恢復、事件後的恢復
＊＊
-檢測 IDS/IPS檢測潛在事件後發告警、反惡意軟件檢測彈窗告警、自動化工具掃描日誌利用定義好的事件觸發告警、當用戶報告無法訪問或更新時潛在事件
>> 需區分IT問題還是安全事件的調查判斷、調查人員或專業人員都能響應發起．
-響應  對事件響應越快越能控制在有限範圍的機會、調查過程保護能充當證據所有數據、不可關機避免ram臨時文件數據丟失
>>> CIRT/CSIRT   計算機事件響應團隊按照嚴重程度、通常在中大安全事件才啟用這個團隊、
>>>              透過教育訓練執行調查、評估損害、收集證據、報告事件、執行恢復程序、還參與補救和總結教訓
-抑制    遏制事件發展限制影響範圍避免傳播其他網路連接的隔離：：段網拔網路線
-報告    內部通報組織和外部相關部門人員、有合法報告要求(PII,PHI),
>>>PCIDSS  要求向執法部門報告某些安全事件、所有人接受相關培訓識別事件如何初步應對,如何報告
-恢復  檢查事項：訪問控制表及規則、禁用不需要的服務和協議、最新的補丁、用戶帳號、受破壞都得到修復、最安全做法是重建系統
-補救  查看事件發生原因在採取措施防止再發生、根因分析對系統改進建議
-總結教訓  響應行動需要改進的方面、增加安全控制、更改策略，管理層決定採哪哪個建議、未採納建議而存在風險負責
--->>託付用戶管理：檢查表、通過禁用或斷開把惡意軟件控制在自己的系統範圍避免闊散

實施檢測和預防措施
-預防性控制  阻止不必要或未授權發生、物理控制、生物特徵、職責分離、崗位輪替、數據分類、訪問控制、加密、回呼程序、安全策略、意識培訓、防毒、防火牆、入侵預防系統
-檢測性控制  監測控在事件發生後才能發現的活動：保安、CCTV、崗位輪替、強制休假、稽核蹤跡、蜜罐密網、入侵檢測系統、違規報告、用戶監督審查、事件跳茶

基本預防措施
-保持即時更新  定期發布補丁糾正錯誤和安全缺陷、確保系統和應用程序通過相關補丁保持攻心
-移除進用不需要服務和協議  避免潛在服務和協易遭到潛在攻擊、無法利用漏洞
-使用IDS/IPS  長事件測攻擊並發出告警
-最新版反惡意軟體  應對措施反惡意軟件程序、最新簽名
-使用防火牆  網路防火牆保護整個網路、主機的防火牆保護單個系統
-執行配置和系統管理流程  確保組織安全方式部署系統始終保持安全狀態
```

```
了解攻擊  fraggle=DoS by UDP :: syn by TCP :: smurf by ICMP
-殭屍網  按照一台指令多台命令和控制C&C,C2、保持休眠到具體日期時間對某件事作出響應發起大範萬的DDoS發送垃圾釣魚走件
>防止系統拉近殭屍網最好採用深度防禦戰略多層次安全保護避免感染、確保是最新的反惡意軟體程序保護
>教育訓練防止釣魚信點擊連結或下載惡意軟件或騙取用戶口令、內建的沙箱隔離web應用程序
>製造商在設計或建構這些系統應充分考慮安全因素給IoT設備易於更新

-拒絕服務攻擊DoS阻止合法訪問或請求、向服務器丟大量的數據包或已知漏洞讓系統無法癱瘓或崩潰、讓系統運行變慢、數據損毀、服務被攔截
>DoS來自單個系統或單系統為目標、利用假造源地址保持匿名很少是真實IP、DDoS多個系統協同攻擊一個、通常利用殭屍網發動DDoS、不會單獨存在
>分布式反射型拒絕服務DRDoS 不直接攻擊受害而是操縱通信流或網路服務、從其他來源反射回受害者 DNS中毒,smurf,fraggle

-SYNflood洪水攻擊  常見的DoS攻擊形式、中斷TCP發起通信交握、發送多個SYN(不同源地址)不回ACK完成連接等到他超時耗盡資源或消耗內存和處理能力
>達到一個極限也會把合法用戶請求攔截、阻止這種攻擊是縮段等待ACK時間可以半數會話從系統內存釋出
>TCP復位是操控TCP會話被FIN結束、RST復位包結束對話、在RST包假造源IP並切斷活會話、就需要重新建立會話
>>>主要是威脅需要持久會話或其他系統交換數據、並不是透過交握來建立會話

>smurf 另一種洪水、淹沒受害者的ICMP回聲包、發送假廣播ping請求回應ICMP給所有系統並假源IP地址、把受害者淹沒、
>>通過路由器發送定向廣播後所有系統都會攻擊受害者、修改路由器默認值不在轉發定向廣播流或禁止ICMP
>fraggle UDP 7, UDP 19使用UDP數據包、利用假受害者IP地址廣播UDP數據包造成所有系統都像受害者丟**UDP flood

-ping洪水 ping請求淹沒受害者、通過一個殭屍網內發起攻擊而且非常奏效、會無法響應合法請求
>對應方法：攔截ICMP回升請求包可以攔截ping通信流但不能攔截所有ICMP、入侵檢測系統可以檢測出ping洪水後改變環境參數把ICMP回升請求攔住．
>>死亡ping  使用超大ping數據包造成超出系統處理能力而崩潰或緩衝區溢出錯誤
>>淚滴：把數據被打碎、使系統收到片段難以組合原始狀態造成系統崩潰
>>land攻擊：把受害IP同時做源IP和目標IP、向受害發送假SYN包、banana 把系統發出消息重新定向回系統、從而關閉所有外部通信

-零日利用  未知漏洞攻擊、不需要服務或協議就移除停用、啟用基於網路和主機的防火牆限制潛在惡意流量跟檢測攔截攻擊、或用蜜罐觀察攻擊情況
>攻擊扯最先發現漏洞輕易利用供應商未察覺這個漏洞、因而開發或發布補丁
>供應商獲悉漏洞但未發布補丁  利用發布前的空擋攻擊因為公眾不知道這個漏洞
>供應商發布補丁系統24小時內被攻擊  利用時間差攻擊

-MITM中間人(路徑攻擊)  兩個輛端點之間建立一個位置監視之間所有通信流、應即時補丁、利用VPN規避。
>複製、嗅探::充當儲存轉發或代理機制、收集登入憑證和其他敏感數據、還能更改之間交換內容、入侵檢測系統檢測不出中間人和劫持攻擊
>在客戶端偽裝服務器、在服務器偽裝是客戶端，需要配合多重攻擊配合(竄改路由和DNS值、獲取並安裝加密證書闖入加密通道，或是偽造ARP(地址解析協議)查找)

-蓄意破壞  對組織資產有足夠了解且具充分訪問權限，被解職後訪問權限依然存在
>>應禁用所有訪問全迅速採取，監測異常或未授權活動、確保員工與管理層溝通順暢

```
入侵檢測IDS和預防IPS系統 == IDPS
```
>IDS  自動檢查日誌和實時系統事件、檢測入侵意圖和系統故障、其他機制進行補充但不回完全取代其他安全機制
>>>識別外部連接攻擊(DDOS)及內部傳播、對入勤做出即時和準確響應方法、
>>>NIST SP800-94 通篇都用IDPS通稱

-基於知識檢測  基於簽名檢測或模式匹配檢測、對已知攻擊數據庫定義模式和特點，假陽性很低、應定期/自動更新供應商提供的簽名跟新攻擊簽名更新::低誤報
-基於行為檢測  **又稱統計入侵檢測、異常檢測、啟發式檢測、累計足夠基線來確定正常活動、還能進行狀態包分析和上下文檢查::高誤報
-真陽姓:發生也被檢測、假陰性:發生未檢測出來、真陰性:沒有發生沒有檢測、假陽性:未發生但被檢測出來
-IDS響應  防火牆前後放置一個被動IDS來衡量防火牆有效性
>被動:發mail或訊息也可生成報告詳細描述事件發生之前的活動、即時通知人員知曉快速隊不良行為作出有效響應
>主動:修改ACL攔阻基於端口、協議、源地址、切斷特定線段所有通信
>>>若有配置主動響應:::截斷該IP所有的通信流、攔截所有ICMP、攔截可疑或不良用戶的訪問、環境中變化需求響應進行調整
>>>主動響應IDS有時又稱IPS、如果未被安放承載通信流線路上(FW,SW前後)就不是真正IPS，NIST SP800-94建議把主動IDS都放在承載通信流的線路上。

-HIDS 在本機系統、應用程序、安全措施、主機防火牆比NIDS詳細能精確具體文件、跟蹤所用的進程
>HIDS包含反惡意軟件的能力，檢測被注入並遠程控制感染:: 許多指安裝在關鍵服務器(成本和易用性)
>不能檢測其他系統受到網路攻擊、**消耗大量資源降低性能、HIDS很容易被發現保留的日誌也容易被修改

-NIDS  支持集中化管理
>使用傳感器監測大型網路再把數據發送給中央管理控制台(SIEM)
>>監測加密通信流  通過https和TLS配套方式，惡意代碼通過加密所以IDPS無法檢查。利用TLS解密器再轉發給IDPS檢查
>>>>APT在過濾之前先對加密，但是通常是傳輸前加密在發送
-->通過執行反向地址解析協議RARP或反向域名系統DNS查找攻擊源，能檢測剛發起或正在進行的攻擊，但無法預防攻擊
-->交換機通常對流氓嗅探器的預防措施，如果交換機配置後把所有通信流映射到IDS特定端口分析SPAN
-->不會知道具體系統帳號文件應用程序，但可以發現緩衝去溢出的惡意利用是透過網路、發生歷程

-IPS  攻擊到達系統前檢測跟攔阻，通信所有流量都要經過NIPS並可以選擇轉發那些通信流
>>>NIPS 使用基於知識,行為檢測還可以向IDS用日誌發送通知


-蜜罐/密網 一個密網內有多個蜜罐
>>>外表行為都向合法系統但是不具實際價值數據，不補釘故意留下漏洞。能拖延入侵者足夠長時間盡可能收集入侵者相關信息
>>>通常放在虛擬環境容易重建，不需要密灌主人誘導進入是合法行為，
>>>但是主動引誘訪客進入網站指控他們未授權就是誘捕，易數非法根據地區法律而定

-警示  告知基本安全方針策略、在線任何活動都會被稽核監控注意受限制行為和進程合法、大多數入侵或攻擊都可被起訴的可接受使用協議

-反惡意軟件  最新簽名文件並具備發動能力、檢涉新的和經過修改的惡意軟件
>對木馬、蠕蟲、間諜、rootkit等惡意代碼大多用殺毒軟件名義經銷、具內容過濾能力防火牆配合使用、中央服務器更新推送個端點
>教育用戶了解惡意代碼的危險性和欺騙用戶安裝惡意代碼及如何限制風險、不要點擊連結或郵件可以避免感染
-黑白名單 允許、拒絕攔截列表是有效預防措施、阻止互用運行未授權應用程序、防止惡意軟體感染

-防火牆
>攔截路由器的定向廣播去淹沒目標的網路、在邊界攔截私網IP(內網)是假源地址就要攔截他
1>基於IP+port帶協議編號的過濾通信流來監控所有進出流量、ACL允許特定通過+以隱式拒絕規則結束(沒有就不給過)、ping使用ICMP在邊界阻止ICMP回升請求
2>第二代防火牆(gateway)增加過濾功能(特定應用程序要求過濾、電路層網關防火牆根據電路過濾)、
3>第三代stateful(狀態、動態包過濾)防火牆根據流量狀態過濾
4>WAF Web應用程序防火牆 處理器密集型但不是所有網路通信流、檢查進入Web服務的所有通信流並阻斷惡意通信流 如：SQLi XXS
5>NGFW下一代防火牆   有多種過濾功能形成統一威脅管理UTM手段、能同時執行過濾和狀態檢查、識別並攔截惡意流量、黑白名單過濾惡意軟件、IDPS

-沙箱  應用程序提供安全邊界、避免本地交互、反惡意軟件是借助沙箱測試未知應用程序防止對其他應用程序或操作系統感染．
-第三方安全服務  組織以外的服務、PT、稽核、SaaS,NGFW,UTM::遵守具體合規安全要求PCIDSS,不允許將自己責任外包？
```
日誌紀錄監測
```
預防事件、發生時有效響應、檢測CIA負面影響形成全面問責體系
日誌紀錄技術  事件訊息或數據庫過程、基於安全身份認證、需要時用於起訴相關責任人
-常見日誌類型
1>安全：資源訪問、修改、刪除時間、管理員為專利數據配置日誌單不公布的公共配置日誌
2>系統：何時啟動關閉、屬性修改、有助於發現潛在的惡意活動
3>應用：有關具體應用程序的信息、開發人員選擇使用紀錄哪些內容
4>防火牆：到達防火牆任何流量放行攔截紀錄、但不高含數據實際內容
5>代理：提高訪問效率控制允許用戶可訪問網站、紀錄詳細信息能力、訪問什麼停留多久或試圖訪問禁止站點
6>變更：變更請求批准和實際變更的人員活動、可以是人工創建或內網創建、成為災難復原計畫提供恢復最後已知狀態和已經實施變更

-保護日誌數據  確保日誌不被篡改、通常把日誌複製到中央系統保護起來保留數年、應設置唯讀分配許可權、執行物理安全控制、不需要時銷毀
>> FIPS 200 按監測、分析、調查、報告違法、未授權、不當信息活動所需程度，創建保護保留信息系統審計紀錄
-監測作用
-->審計蹤跡   有關和事發情況保存到多個數據庫或日誌文件創建紀錄的活動，用於證明罪責、反駁指控、其他目的，屬於被動形式
------>>  拿出時間定位和刪除有可能活動記錄下來的APT標配，資源系統前後對比有助於確定造成原因，要確保日誌不被人竄改刪除
-->監測和問責  確保形式主體對自己的行為和活動負責、督促遵守組織安全策略、一半觸發違規應立即確認源頭。
-->監測和調查  確保給日誌打上準確時戳跟整個環境保持一致(內部NTP)
-->監測和問題識別   可再應用程序或系統崩潰時捕獲內存內容，有助於事件發生原因或可能攻擊清除，日誌文件適用於識別問題

-監測技術  找出特定內容過程、也可視人工或自動化工具對主體惡意行為或圖謀入侵行為。旨在收集更多攻擊者情報
>日誌分析  系統化的監測形式找出趨勢和模式、異常、未授權、違法、違反策略的活動，使用自動化工具分析日誌(ids)、主動對安全健康和性能監測
>安全信息和事件管理  集中中央日誌紀錄來自各agent，全組織範圍系統發生事件實時分析跟監控流量還提供長期儲存，轉換有用消息
-->具精細關連引擎和聚合數據功能、內置工具預配條件觸發告警、也可監測未授權安裝的狀況降低無逸安裝惡意軟體的風險

>syslog(RFC5424)   接收網路設備的syslog，協議規範格式化消息和怎麼發送給 syslog server
>抽樣sampling/estraction  特定元素建控有意義價值的概述或摘要(數據縮減)，但無法體現整體數據的準確度
>剪切級clipping  預先定義好的事件閥值，為到達之前忽略事件，建立一條基線超過才發報
>其他監測工具   CCTV、敲擊監測(竊聽):分析用戶活動
-->通信流分析traffic趨勢分析trend::檢查數據包流動非內容的監測形式(網流監測)、大量異常模式是否變殭屍

-日誌管理  收集、處理、保護日誌目的所有方法
>SIEM收集和聚合多系統日誌條目並分析是否任何可疑事件、系統把日誌傳給SIEM之後可以刪除日誌條目、但往往都是用循環滾動日誌把舊的覆蓋
>或滿的時候再創建一個但危險是硬盤會被塞滿、可利用腳本另存到其他路徑備份
-出口監測
-->DLP數據丟失預防 未加密文件的水印並識別敏感數據後阻擋並發出告警
-->隱寫術  把消息坎入其他圖型或影片、可利用hash驗證
-->數字水印  隱藏在數字標記、每個副本標記都不同可以知道哪個代理商洩漏
```
SIEM:監測多個系統、SOAR：常見攻擊自動做響應
```
安全編排自動事件響應SOAR 組織自動響應某些事件的技術、安管人員靠手動操作並核實每個告警再作出響應
>根據事件不同發數告警並採取其他行動、安管人員可以使用腳本自動化定義及對事件響應或手動執行

-機器學習和AI工具
>機器學習事AI的一部分、通過經驗自動改進賦予學習能力、基線起點歸納規則才能有勝算
>AI包含機器學習還具備不需要人工干預狀況完成任務、從無到有反覆與自己練增加經驗哪些是有效跟無效策略的回饋自己獨立算法
-->AI包括深度學習、ML、專家(知識庫+推理系統)、自然語言

-威脅情報  收集潛在威脅、利用各種來源獲得威脅
殺傷鏈
>偵查尋找或識別目標、確認位置、跟蹤定動、挑選打擊的武器、選定武器打擊、評估攻擊效果
>偵查(收集)、武器化(識別漏洞)、交付(漏洞途徑)、利用(利用漏洞)、安裝(安裝惡意代碼)、指揮控制(維護控制被操縱目標)、目標行動(達成目標)

MITRE ATT&CK  MITRE已識別戰術、技術和規程TTP的知識庫、網路殺傷鏈模型補充、TTP列矩陣一年只少更新兩次攻擊方法
>偵查>資源訪問>初始訪問>執行>持續存在>特權提升>防禦規避
>>憑證訪問>發現>橫向移動>收集>指揮控制>外洩>影響

威脅饋送feed, RSS(really simple syndication) 當前潛在威脅一種穩定原始數據流、但難提取有意義的數據或可執行情報、情報出售給客戶
>可疑域、已知惡意軟件的哈希值、網站共享代碼、關聯IP：：通過日誌跟蹤和手動交叉檢查威脅饋送、也可使用工具自動化
威脅搜尋hunting  主動查找威脅過程、就算沒有發告警也積極尋找跡象、避免惡意攻擊長期停留不被發現

SOAR,ML,AI,feed
-SOAR  要有劇本或指南來執行腳本、執行重覆步驟消除人為錯誤
-IDPS  經查誤判報告、但採用SOAR技術可自動處理誤判率、IDPS需實時更新威脅信息
-威脅饋送  如果SOAR技術能接受處理威脅饋送、能確保系統都知曉新威脅並自動響應(立即攔截、惡意軟件哈希)
```
