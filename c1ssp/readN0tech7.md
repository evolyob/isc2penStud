ch7 PKI密碼應用
||演算法|優點|缺點|數量|
|:--:|:--:|:--:|:--:|:--:|
|對稱|塊密碼DES/AES/RC6|快、明文=密文|金鑰共用128bits|n(N-1)/2|
|非對稱|RSA/ECC|私鑰不共用|慢、密文比明文大|2N|
```
你要加密消息要用接收者公鑰
要解密對方發給你消息用自己的私鑰
要發給別人的數位簽章用自己的私鑰
要驗證別人的數位簽章用發送方的公鑰

非對稱密碼 任意把自己的公鑰傳輸給對方加密，用自己私要解密．通常用簡短消息 利用素數數學原理支撐
｜對稱｜128 |
｜RSA｜3027|
｜橢圓｜256 |
-merkle hellman weak 
RSA  ElGraml ECC橢圓曲線密碼 
Diffie Hellman 允許通過不安全通道生成共用密鑰與對稱加密算法通信(hybrid混合密碼)
-不是加密協議，只是密鑰交換協議、常用於TLS使用(DHE or EDH)創建共享密鑰
-ECDHE密鑰交換算法是種變體用到橢圓曲線問題來執行類似密鑰商定過程
-如果用相同密鑰長度那安全性會高於其他算法

量子密碼 量子比特qubit的多為量子為取帶數字計算二進位，讓RSA、DH流行算法便不再安全
-量子密鑰分發 quantum key distribution QKD執行方案 類似DH窗間共享密鑰

哈希函數 hash function
-較長>=128 訊息產生唯一輸出值持行偶基校驗功能
-五要求：輸入任何長度、輸出固定長度、哈希函數對輸入相對容易、單向函數、抗碰創
-HAVAL是md5修訂版使用1024為塊產生 128, 160,192,224,256

SHA NIST, FIPs180
-SHA1  任何長度生成一個160位消息摘要，可處理512塊中的消息，用附加數來填充消息 2017棄用
-SHA2。四個變體
SHA-256｜512位塊大小 生成256位消息摘要
SHA-224｜512位塊大小 生成224位消息摘要
SHA-512｜1024位塊大小 生成512位消息摘要
SHA-384｜1024位塊大小 生成384位消息摘要
SHA3跟SHA2同等安全強度但是比較慢

MD5
-MD2可為8位處理器產生哈希、MD4支持32位處理器產生哈希 摘要都是128位元
-MD5與MD4相同但是消息長度512位的倍數小64位，降低生成速度，很容易出現碰撞

RIPEMD (128=256,160=320) 是SHA系列的替代方案，被應用在加密貨幣 160現在是安全的

數位簽章  公鑰加密碼跟哈希組合，只對簽章本身做保密性 身份不可否認性
-保證是發送者(不可否認性)，抵制惡意竄改．
-明文生成哈希摘要、再把私鑰單獨哈希摘要加密(就是數位簽章)
-簽名消息摘要附件明文消息末尾，明文用對方的公鑰加密
-對方收到自己的公鑰解開數位簽章，在用對方私鑰解開秘聞

HMAC 可保證傳輸過程的完整性，但不提供不可否認的服務
-通過共用密鑰跟任何hash算法配套使用，只有知道密鑰通信參與方才可以生成或驗證．

數位簽章標準 DSS FIPS 186-4 (必須是SHA3的hash)
支持基礎設施或批准的三種標準加密算法
1.FIPS 186-4|DSA by ElGamal ==> EdDSA 曲線數字簽名算法
2.ANSI X9.31|RSA
3.ANSI X9.62|DSA(ECDSA)橢圓曲線

PKI public key infrastructure 公鑰基礎設施
-協助不認識雙方進行通信，把對稱、非對稱、數位簽章、哈希結合使用混合加密法

證書 certificate  一個人的公鑰簽注副本由可信發證機構CA發簽，讓公鑰是合法．

-遵守X.509版本、證書創建者編制的序號、簽名算法標示符、發證者名稱、效期起始終止日
-主體名稱(普通名稱CN,公鑰實體可識別名稱DN)、主體的公鑰(證書主要內容、擁有者建立安全通信實際公鑰)
-證書使用目的包含對象的公鑰：計算機機器、個人用戶、電子郵件地址、開發者(代碼簽名的證書)
發證機構 CA certificate authority 負責發證
-自己身份已達到這幾家CA的要求
-如果你自己websiteg設置信任一家CA，自動信任這家發的數字簽證

註冊機構 RA registration authority 本身不直發簽證書，負責認證過程讓CA能遠程驗證用戶身份
離線CA保護自己的根證書root certificate不被需要時斷網斷電，離線CA創建次級中間CA充當在線CA．
-證書鏈，為了驗證證書．瀏覽器鮮豔正中間CA身份，沿著信任路徑追朔到已知根CA
-自簽證書，內部系統配置後可信任CA單不對外遊覽器信任，節約獲取證書費用
##憑證驗證中心VA 查詢憑證有效性##

證書生命週期 註冊>驗證>註銷
1.註冊enrollment 向CA證明自己的身份
-CSR certificate signing request證書簽名申請提供自己的公鑰，CA創建一份X.509格式證書(身份識別和公鑰拷貝)
-CA在證書上用CA私鑰寫上數位簽名並把簽了名的數位簽章副本給你
-域驗證 domain Validation  CA只驗證證書主體對域名是否有控制權．
-擴展驗證 extended Validation CA採取步驟驗證擁有人是不是合法企業
2.驗證 用CA公鑰檢查CA在證書上數位簽章跟效期．
-必須比對證書註銷列表CRL certificate revocation list和在線證書狀態協議OCSP online certificate status protocol來確定這份證書未被註銷
-需滿足要求 CA數位簽章真實、你信任這家CA、未被CRL收入、證書包含你信任的數據
3.註銷 revoke
-失信擁有者意外洩露私鑰、CA誤發證書、細節更改(主體名稱變化)、安全關聯變更(主體不再被CA雇用)
三種驗證正數真實性和識別被註銷的證書
-證書註銷列表CRL 各家發證機構維護(發簽註銷序號、註銷生效日期時間)，定期下載交叉比對
-在線證書狀態協議OCSP 客戶端收到CA'sOCSP發送一個OCSP請求，伺服器把該證書有效無效未知狀態回復給客戶端
-證書裝訂(效期24hrs) OCSP的擴展 接受簽名和時戳裝訂或附加在數位簽章上，web將證書跟OCSP裝訂一起發送給用戶
```
證書格式
|DER|區分編碼規則|二 進 制|.der, .crt, .cer|
|:--:|:--:|:--:|:--|
|PEM|隱私增強郵件|ASCII文本|.pem, .crt|
|PFX|個人信息交換|二 進 制|.pfx, .p12|
|P7B|          |ASCII文本|.p7b|

```
非對稱密鑰管理
-算法的保密性確保密碼系統完整性關鍵、密鑰長度在要球跟性能、密鑰隨機生成、不允許別人訪問私鑰、輪換時限、可用備份或使用第三方幫保存備份
-硬件安全模塊HSM hardware security module 人員不必直接接觸密鑰，提高密碼運算、流程加速
-使範圍差異使用適合的設備、內置房篡改機制、雲服務IaaS提供HSM安全密鑰管理

混合加密法 hybrid cryptography 對稱跟非對稱結合 常用於TLS

可攜設備
-可信平台模塊 TPM trusted platform module 設備主機板的一塊芯片，保存或管理全硬盤加密   FDE full device encrypt解決方案的密鑰
-TPM 成功驗證用戶身份後提供密鑰訪問權，防止把硬盤拆下來插進另外設備訪問數據


電子郵件
C信件加密、I信件算個哈希、身份認證不可否認性 加個數位簽章
-良好隱私openPGP允許使用現代加密法、哈希函數、簽名標準
-webmail插件形式是取消配置維護加密證書的複雜操作
S/MIME 安全多用途互聯網郵件擴展 secure/multipurpose internent mail extensions
-加密電子郵件的事實標準，使用RSA加密算法．通過X.509證書交換加密密鑰，接收用的S/MIME簽名，但是webmail不支持

web應用
1.SSL安全套接字層 透過HTTPS加密但是有大量關鍵缺陷，所以不安全
2.TLS傳輸層安全 透過憑證與webserver之間協議家解密參數，創建開放開放安全通道結合對稱跟非對稱 TLS TLS
-用戶檢索web的憑證中提取公鑰、瀏覽器創建隨機的臨時對稱密鑰、用web公鑰加密臨時私鑰給web
-TLS1.2取消向後兼容性(不支援TLS降級SSL3.0) TLS不是加密算法只是個框架，要確保配套算法是安全
-POODLE揭露TLS的SSL3.0回退機制，所以全面取消支援SSL
-密碼套件四大組成  TLS DH/_RSA_/With_AES256_CBC/_SHA384
a.用於臨時密鑰交換的算法 RSA, DH, ECDH
b.用於驗證身份算法 RSA, DSA, ECDSA
c.用於對稱加密的批量加密算法 AES, 3DES
d.用於建立消息摘要的哈希算法 不同版本的SHA算法

3.洋蔥tor 暗網 通過加密和一組中繼節點匿名互傳送通信流
-前向保密技術，多層加密可阻止中繼鏈結點讀取斯要接收轉發的特定信息以外任何訊息
-完全前向保密與一組(3up)中繼節點結合再一起，可匿名看正常網站又可以在暗網託管完全匿名網站．

隱寫術steganography水印 加密技術把秘密消息嵌入另一條不重要部分(圖像或影片檔)作改動，常用於非法、間碟、色情

路線加密
-鏈路加密link encryption (vpn) 建立兩件之間隧道、一端加密流入另一段解密流出、常用於兩個辦公區域
>header頭尾、地址、路由數據都被加密，的每個中繼都重新加解密再傳送到下一個減緩路由速度
-端到端加密 end to enf encryption 用戶到server通信加密(TLS、SSH)，防止已知入侵者在監控透過位加密傳送
>不給header頭尾、地址、路由數據加密，傳送更快但是遇到嗅探和竊聽梗脆弱
>SSH1不安全，支援DES,3DES,IDEA,Blowfish
>SSH2 取消支援DES, IDEA，增加DH密鑰交換協議．抵禦中間人攻擊、竊聽、spooling ip/dns
--->ssh2 增加對單個ssh連接上同步shell會話、不再支持IDEA
--->ssh1&ssh2都支持多因子身份驗證和3des

IPsec互聯網協議安全
組成兩個主要部份,
-身份投認證AH 保障消息完整性和不可否認性、AH身份認證和訪問控制
-封裝安全載荷ESP 保障數據內容保密性和完整性、ESP加密和很有限身份驗證(低於AH水準)
-傳輸模式transport、端到端全程加密只加密數據包的堆等通信
-隧道模式tunnel 只有通道加密、加密包括報頭哪整個數據包的鏈路加密
-安全關聯security association SA 建立IPsec會話紀錄有關聯所有配置狀態信息、代表一次單純連接
> 如果要建立雙向那要需要兩個SA，若要建立同時有AH+ESP雙向通信 需要建立四個SA．．在沒有明確定義有效SA無法成對建立IPsec鏈路
L2TP  IPsec AH給看不給改|ESP不給看不給看

新興的應用
1.區塊鏈 blockchain 份不是不可變公共分類帳，把紀錄分散保存各地不同系統防止任何人竄改記錄．常用於加密貨幣cryptocurrency
-加密貨幣 比特幣不用中心化機構(中央監管)就可跟蹤比特幣交易，紀錄存放在透明公共儲存庫、可跟蹤供應鏈確保信譽良好來源、輕鬆追朔被招回產品來來源
2.輕量級加密 專用節能硬件將損耗降至最低、堆低延時要求高盡快完成加密
-專用VPN硬件設備包含密碼硬件包含高興執行加解密．為保證完整性數據發送方保留副本直到完成接受和解密
3.同態加密 homomorphic encryption 需要保護PII又要用PII進行計算，保留對數據計算的能力、解密數據會與最初明文結果一致


密碼攻擊
1.分析攻擊  降低算法複雜性，焦點是酸法本身邏輯
2.實現攻擊  探詢執行過程暴露弱點，挖掘軟件代碼為主的加密系統算法編程方法
3.統計攻擊  統計攻擊探詢密碼系統統計學弱點、承載密碼應用硬件或操作系統找出漏洞
4.暴力破解  找出密鑰或口令每種可能有效組合猜測加密通信的密鑰
5.故障注入  造成外部故障來破壞密碼設備完整性,電壓溫濕度異常破壞設備
6.側信道攻擊 處理器功率、功耗、電磁波輻射的變化，尋求監控系統活動相關使用資源
7.計時攻擊   側道攻擊的例子、精準算出完成加密所需時間獲取破壞加密過程安全保護

改進暴力破解效果
-彩虹表示哈希提供預先算出的值常用於破解哈希保存在系統的口令
-專報李破解設計可擴展的影鍵提高攻擊效率
--->雙重哈不會提供任何額外安全保護

加鹽保護口令 鹽密碼是隨機碼 再進行哈希運算前添加末尾並保存在口令文件中
-先檢索鹽將其附在口令後、操作系統像哈希函數數入連續值、得出哈希值與保存口裡文件裡的哈希值做比對
-任何創建彩虹表都必須為密碼鹽另外創可能值表
-加鹽有PBKDF2, bcrypt, scrypt，加鹽可降低彩虹表攻擊效果

頻率分析和唯密文攻擊 ciphertext only attack 擺弄只供加密的密文 比如說英文常見字母 eation
-這些字母在密文使用最頻繁，那可能是位移密碼．重新排列就可得明文字符
-如果使用字母是其他字母，可能是替換密碼，明文字符更換
--->要求訪問密文

1.已知明文 掌握加密消息副本和用於生成密文消息，破解弱代碼、讓攻擊者能夠加密數據、明文和相應密文
2.選擇明文 選擇一組明文對應的密文，嘗試提取密鑰 差異分析的明文攻擊、讓攻擊者能夠加密數據
3.選擇密文 要求訪問算法通過攻擊者執行加密、能夠解密密文被選中部分消息發現密鑰
4.中間相遇 兩輪加密算法2DES被棄用改用3DES，已知明文可能被k1加密然後再用可能k2解密．因為只是單輪加密
5.中間人  攔截所有通信 冒用原發者與預期接收第二安全對話，可讀取通信參與之前所有訊息．又稱路徑攻擊
6.生日    碰撞攻擊(collision attack)或是反向哈希匹配reverse matching，尋找哈希函數一對一值找出破綻(字典)生成相同的hash值
7.重放  沒有採用臨時保護措施算法，透過攔截加密消息(身份認證請求)，重放捕獲的消息建立新會話，每條消息打上時戳並給他設定過期時間
=>用臨時會話密鑰身份認證的話可以抵禦


```
