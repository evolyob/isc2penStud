ch.14 控制和監控
```
-權限  授予對客體的明確允許訪問權
-權利  對客體採取行動的能力(修改、回復備份)
-特權  權力和特權的組合， 管理員擁有全部特權。
理解授權機制
-隱式拒絕    大多授權機制使用隱式(默認)拒絕，除非已明確授予主體訪問權
-訪問控制矩陣 包含主體、客體和分配精準的權限表格，每次檢查確定主體是否有執行操作適當權限，
-能力表      另一種主體所分配權限方式但與ACL不同，
> 能力表主要關注主體(用戶、組、角色)、 該"角色"被允許角色訪問所有客體
> ACL主要關注客體，有訪問該文件所有用戶或組，授予用戶或組具體訪問權限
-約束接口  應用程序利用受約束或受限制接口、限制用戶可直行或訪問 (clark-wilson)
-基於內容控制    依據客體內容來限制數據訪問，比如只能看部分表格欄位，無法訪問底層表格數據
-基於上下文控制  授予用戶權限前須要用戶執行特定的活動(購物流程若未完成就無法訪問)，也可基於時戳允許時間以外不可訪問。
-因需可知    主體僅能訪問分類或受限數據許可，但未得訪問數據授權，除非為工作完成任務所需內容
-最小特權    確保主體僅擁有執行工作所需權限，包含系統執行操作的權力
-職責分離    將敏感值能畫分數個共同完成任務，創建一個檢查和制衡系統訪指欺詐和錯誤
-
```
介紹訪問控制模型
```
-自主訪問控制 DAC 所有者可允許或拒絕其他主體訪問(windows NTFS文建系統)
>基於身份訪問控制：所有者、創建者、數據託管者可自由裁量權或決定權
>使用客體訪問控制列表ACL實現、完全控制其客體
非自主訪問控制  靜態規則、集中控制、不關注用戶身份

-基於角色訪問控制 RBAC  角色或組，不是直接向用戶分配權限， 用戶是哪個角色就給他角色權限
>角色或群組、預防特權蠕變(需求變化累積特權)有助於最小特權原則、匹配組織中工作職能或角色
>管理員不直接為用戶分配權限、通過添加到角色或群組
TBAC基於任務訪問控制：每個用戶分配一組工作任務關聯而不是用戶的身份、不能處理其他任務

-基於規則訪問控制  模型中規則(FWpolicy)也稱為限制或過濾器
>決定系統允許和禁止發生的操作、主客體訪問權限獲授予主體操作的權限、適用所有主體全局規劃
>不符合前面明確定義原則、那最終原則可以拒絕或阻止。

-基於屬性訪問控制 ABAC  使用包含多屬性規則，客體定義哪幾個屬性主體可訪問
>SDN軟體定義網路應用程序是使用ABAC、基礎設施和控制層拆分使組織可自由從不同來源購買硬件
>SDWAN基於ABAC實施策略允許或阻止、管理人員允許使用設備訪問WAN、改進基於規則訪問控制模型
>MDM移動設備管理可使用屬性來識別移動設備、情境感知屬性(時間、地點、設備類型)

-強制訪問控制 MAC 如果具絕密標籤那就能訪問絕密，主客體標籤可以匹配記錄在格子的模型
>依賴分類標籤使用一格代表一個安全域共享相同方式保護擁有有秘密標籤所有對象、屬於一種特權形式
>單獨的隔離安全域、提供額外保護層、需要有附加標籤跟隔離區標籤才可訪問、屬於禁止性隱式拒絕原則
-->分層環境  按照高中低排序結構、允許訪問同級別或向下級別的客體
-->分區環境  安全域之間是無關連單獨隔離區、訪問客體主體必須有客體明確許可
-->混合環境  分層和分區訪問概念、每層級別包含多個子分區、子分區是互相隔離、
-->>       主體需有正確許可和具體隔離之間的因需可知的數據才能獲的分區客體訪問權限

-基於風險訪問控制 嵌在軟件代碼的策略來評估環境和情況，基於風險決策運用機器學習用過去活動對當前活動做預測
>評估風險元素：環境、情境、安全策略、、
>安全策略是軟件代碼依據現有數據做出基於風險決策、修改軟件配置來支撐安全需求
>>>環境：IP地址的地理位置、是內部、外網、國外、匿名、不熟悉位置登入用戶
>>>情境：IoT設備在做什麼可預測行為、突然的惡意流量阻止訪問、
>>>安全策略： MFA、合規移動設備滿足特定安全要求、最新的操作系統和設備加密

互聯網上實現SSO
-多站點支持SSO簡化用戶體驗確保某站點身份憑證不會被其他站點共享、絕不把自己的憑證提供給第三方
-XML可擴展標記語言 XML可包含標記、從描敘所有所需數據、多供應商依XML格式導入導出、成交換信息通用語言、雲提供商XML共享信息身份認證和授權信息
-SAML安全斷言標記語言 基於XML開放標準常用於聯邦組織之間交換身份認證和授權AA信息、支持瀏覽器訪問SSO功能
>>SAML2.0 是SAML1.1、OASIS、自由聯盟統一和框架ID-FF1.2+shibboleth1.3融合
>>SAML2.0使用三個實體：委託人或用戶代理-->>服務提供商SP-->>身份提供者IdP(持有用戶身份認證和授權信息的第三方)
***SAML2.0基於XML、可以提供主體認證、授權和屬性信息

IdP三種類型的XML聲明消息
>>>認證聲明  使用正確的身份憑證、標示身份認證方法、表示用戶代理登入時間
>>>授權聲明  用戶代理使否有權訪問請求的服務、若拒絕會說明原因
>>>屬性聲明  可是關於用戶代理任何信息

OAuth2.0開放授權 RFC6749 互聯網工程任務組IETF維護的授權框架、與第三方網站共享帳戶信息
-帳號A綁定B>B重定A登入帳號>授權A允許前往B的授權令牌>B直接接受輸入收權令牌、優點：B受破壞也不暴露你的憑證、不向後兼容
-是授權框架、利用API消息並使用令牌顯示訪問是否已授權
*** 應用程序從身份提供者獲取訪問令牌-->應用程序包含用於授權的訪問令牌

OpenID 開放標準非RFC標準、一組憑證登入多個不相關網站、中心化身份認證標誌互相建立安全通道並要求口令

OIDC(OpenID Connent)  使用OAuth2.0授權框架身份認證層、同時提供身份認證跟授權
-JWT 使用javaScript對象表示法JSON Web令牌、可稱ID令牌、OIDC使用Web服務檢索JWT的身份認證和有關用戶個人資料、發生在後台
-OAuth提供授權、OIDC使用OAuth框架授權並技術進行身份認證、OIDC使用JSON Web令牌
```
內部網路實現SSO
```
AAA 身分驗證、授權、計費::通過遠程訪問系統VPN或其他類型、集中式訪問控制
>有助於確保內佈局域網身分認證、避免遠程攻擊
>計費要素: 可跟蹤用戶的網路資源使用情況

Kerberos 票證身分認證AES(不明文傳輸) 證明自己身分簽發票證，訪問資源出示這些票證即可、儲存在目錄服務、NTP校時
-端到端安全為身分認證流量提供保密性和完整性，域防竊聽和重放攻擊
>密鑰分發中心   來驗證客戶端，客戶和服務器都要註冊KDC，KDC維護所有成員的密鑰
***>身分認證服務器  乘載KDC功能:票證授予服務TGD和身分認證服務AS、、鑰驗證票證真實性和時效性
>票證(ST)  一種加密消息，證明主體被授權訪問對象、具特定生命週期和使用參數，過期要請求延期或新票證才可繼續。
>票證授予的票證TGT(加密鑰、到期時間、IP)  提供證據，證明主體已通過KDC身分認證並可請求票證訪問其他對象時出示TGT
>Kerberos主體  通常是用戶但也可以是任何請求票證的實體
>Kerberos領域  由Kerberos控制邏輯區域，領域內主體可以向Kerberos請求票證、Kerberos可以向領域內的主體發出票證
>>登入流程: 輸入帳密>>使用AES加密傳輸到KDC>> 生成一對密鑰,KDC使用用戶口令哈希值隊密鑰加密跟附帶TGT的時戳>>回傳客戶端使用直過期
>>使用用戶口令哈希值來解密對稱密鑰
客戶端獲得票證流程
>>自己TGT發送到KDC請求訪問資源>驗證TGT是否有效並檢查控制矩陣>>驗證用戶是否具有足夠權限訪問請求
>>>>KDC生成服務票證發送給客戶>>客戶端將服務票證發給託管資源服務器>>託管資源服務器驗證有效

RADIUS 遠程認證撥入用戶服務集中訪問連接、VPN，適用多台網路訪問服務器、服務器將用戶憑證轉發至RADIUS做身分認證、授權、跟蹤計費(AAA)
-基於位置的安全(IP)、物理定位技術識別用戶位置、RFC2865默認使用UDP1812僅加密口立交互過程、不會加密整個會話:
-RADIUS/TLS,,RadSec :RFC6614實驗版 TCP2083使用TLS傳輸安全層

TACACS+ cisco開發的增強型終端訪問控制器 :: 身分認證、授權、計費劃分獨立進程::使用TCP49為數據包加密所有身分認證信息的可靠性

```
訪問控制攻擊
```
-特權提升  
>su/sudo  授予使用sudo並減少使用、日誌可以記錄用戶使用命令、
>Poweshell  網路偵察活動然後遠端任意執行腳本、執行策略設置restricted、建議創建服務帳號而不是本地系統帳戶

-口令攻擊  使用強口令 足夠長跟口令短語、組織常用強hash(sha-3)生成口令哈希值後儲存
>以加密格式將哈希值發送身份認證系統解密進行哈希值比對、更改預設密碼 windows安全帳戶管理器(SAM),linux /etc/shadow
-字典攻擊  預設每個可能秘密或常見單字數據庫、一次性構造密碼 passwd1,passwd2...
-暴力破解  可能所有字母、數字和符號組合、混合攻擊先用字典在用一對一構造變化、
>>>口令驗證身分流程：輸入帳號密碼、進行哈希處理後發送系統、與密碼數據庫哈希值配對
>>>暴力破解流程：猜測口令、猜測口令哈希值、與離線數據庫儲存哈希值比對、直到猜到具有相同哈希值
-噴射攻擊  特殊型暴力破解、試圖繞過帳戶鎖定安全控制、使用相同的猜測口循環遍歷一個列表(不同帳戶跟系統)
-憑證填充攻擊  檢查每個站點單個用戶及口令的憑證數據庫、撞庫攻擊、建議使用不同的口令
-生日攻擊  查找具有相同哈希值的任兩個密碼、就會像真實密碼一樣有效
-彩虹表攻擊  使用大量預計計算的哈希數據庫來減少所需時間、猜測口令的哈希值跟口令放到彩虹表在跟被盜的口令數據庫的哈希值比對直到匹配
>通常使用加鹽口令減少彩虹表攻擊的有效性、鹽是和哈希口令儲存在同一數據庫的隨機數、所以獲取數據庫後也會得到口令的鹽、胡椒是儲存在別處的大常數

-mimikatz  讀取內存憑證進行漏洞利用
>從系統服務進程中內存讀取口令和pin、口令哈希值：：cryptoAPI模塊提取系統證書和相關連的私鑰：：讀取windows的LM,NTLM哈希值保存在本地安全帳戶管理器SMA的數據或創建哈希值時儲存在內存．
>本地安全機構子系統服務LSASS通常不會以明文出存但惡意修改註冊表、啟用摘要認證就可以讀取口令
>枚舉正在執行進程、使用powershell腳本invoke-mimikatz加載到內存中

-哈希傳遞PtH攻擊 客戶端捕獲生成口令哈希值發送身份驗證服務、攻擊者不需要知道實際口令：：主要對NTLM(NT LANmanager),Kerberos、其他系統也是很容易
>攻擊流程：利用工具捕獲(lsass.exe)用戶或管理權限最近登入口令哈希值、偽裝用戶,本地系統,遠程進行身份認證、一但成功就可使用整個網絡
>PsExec(PsTools)  用於連接遠端主機的命令行工具、列出進程、重啟、轉除事件日誌、通過網路橫向移動到其他台

-Kerberos漏洞攻擊
>>>>impacket python在linux使用的開元模塊及合、rubeus C#編寫的開源工具 適用於windows
>超哈希傳遞攻擊(傳遞密鑰)  當禁用NTLM的替代攻擊方案，因為系統仍然NTLM哈希直儲存在內存，攻擊者使用用戶口令哈希直請求票證授予的票證TGT訪問資源
>票證傳遞  試圖獲取lsass.exe進程中保存的票證再注入票證冒充用戶
>白銀票證  截獲服務帳戶NTLM哈希直創建票證授予"服務"TGS票證(不是TGT)具有服務帳號所有特權
>黃金票證  只要獲得Kerberos服務帳戶KRBTGT的哈希直(因永遠不改)，就可在活動目錄隨意創建票證、可對所有Kerberos票證加密和簽名
-嗅探攻擊
>
>
-欺騙攻擊
-
```
```

-
-
-
-
-
-
-
-
-
-
-
-
-
```
```

-
-
-
-
-
-
-
-
-
-
-
-
-
```
